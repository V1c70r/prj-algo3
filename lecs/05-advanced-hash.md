# Распределенные хеш-таблицы

## Консистеное хеширование

Консистентное хеширование — это способ построения хеш-функций для распределенных хеш-таблиц, который решает задачу минимизации перераспределения ключей при добавлении или удалении нового узла. В распределенной хеш-таблице из `k` узлов, на каждом узле должно хранится в среднем `1/k` ключей. При использовании обычных хеш-функций в случае удаления или добавления нового узла все ключи на всех узлах нужно будет перераспределить между узлами. Однако, это число можно сократить до порядка `1/k`. Эта задачу и решается в рамках консистентного хеширования. 

Для этого имя каждого узла также хешируется и для хранения конкретного ключа выбирается узел, хеш которого - первый следующий по величине по сравнению с хешем ключа. При удалении/добавлении узла это оказывает влияение только на ключи, которые находятся на условном круге хешей между хешем этого узла и предыдущим по величине. Чтобы обеспечить действительную равномерность распределения ключей для каждого узла создается `p` виртуальных "реплик", хеши которых вычисляются от имени узла + номер реплики.

![](img/connsistent-hashing.png)

## Рандеву-хеширование

Рандеву-хеширование — это альтернативный подход к решении той же задачи миниммизации количества хешей, требующих пересчета при изменнии кодичества узлов в распределенной хеш-таблице. Суть подхода в том, чтобы для получения узла хранения посчитать хеши всех пар ключ-узел и выбрать наибольший хеш (для `m` копий - top m наибольших).

## Литература

- http://www.tom-e-white.com/2007/11/consistent-hashing.html
- http://michaelnielsen.org/blog/consistent-hashing/
- https://www.quora.com/How-does-rendezvous-hashing-compare-with-consistent-hashing-When-should-one-be-chosen-over-the-other
- https://medium.com/vimeo-engineering-blog/improving-load-balancing-with-a-new-consistent-hashing-algorithm-9f1bd75709ed
- http://www.paperplanes.de/2011/12/9/the-magic-of-consistent-hashing.html


# Идеальное хеширование

Идеальное хеширование — это подбор для заранее известного (статического) набора ключей такой хеш-функции (или набора хеш-функций), которая гарантирует отсутствие коллизий (т.е. время доступа к ключу ровно за k операций, где `k` — небольшое число). Поиск такой хеш-функции, как правило, выполняется с помощью рандомизированного алгоритма, время работы которого зависит от размера таблицы:

- обычное идеальное хеширование создает таблицу с некоторым запасом (20-30%)
- *минимальное* идеальное хеширование создает таблицу, размер которой равен числу ключей
- также может использоваться многоуровневая таблица (как в цепном методе), где для каждой коллизии подбирается своя идеальная таблица.

## Литература

- http://stevehanov.ca/blog/index.php?id=119
- https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-046j-introduction-to-algorithms-sma-5503-fall-2005/video-lectures/lecture-8-universal-hashing-perfect-hashing/
- http://burtleburtle.net/bob/hash/perfect.html
- http://cmph.sourceforge.net/
- http://homepages.dcc.ufmg.br/~nivio/papers/cikm07.pdf
- http://cmph.sourceforge.net/papers/chm92.pdf
- http://www.cs.wustl.edu/~schmidt/PDF/gperf.pdf
