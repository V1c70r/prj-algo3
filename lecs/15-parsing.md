# Парсинг

## Грамматики и автоматы

Грамматика — это набор из 4-х компонентов:

- T - множество терминалов — символов, которые встречаются в тексте, написанном на каком-то языке (например, для русского языка — это буквы, цифры и знаки препинания)
- N - множество нетерминалов — служебных символов, которые используются для описания грамматики языка, но не встречаются в самих текстах (для русского языка это могут быть такие символы как: <предложение>, <глагольная фраза>, <существительное> ...)
- S - корневой нетерминал (например, <предложение> или же <корень>)
- R - множество правил продукции, которые имеют вид: `a -> b`, где `a` и `b` - это последовательности терминалов и нетерминалов

Применение правил продукции позволяет сформировать дерево разбора текста. Например, для предложения "Дети идут в школу." дерево разбора может выглядеть следующим образом:

```
                                <предложение>
           /                       |                            \
<фраза с существительным> <глагольная фраза>          <знак препинания>
          |                  /         \                         |
  <существительное>   <глагол>  <фраза с обстоятельством>       "."
          |                 |        /                \
       "Дети"            "идут"  <предлог>     <существительное>
                                    |                 |
                                   "в"             "школу"
```

Для построения такого дерева были задействованны правила:

```
<предложение> -> <фраза с существительным> <глагольная фраза> <знак препинания> | ...
<фраза с существительным> -> <существительное> | ...
<фраза с обстоятельством> -> <предлог> <существительное> | ...
```

В теории вычислений установлена эквивалентность между разными типами грамматик (описывающих различные классы языков) и автоматами, которые могут производить вычисления. Она называется иерархией Хомского:

| Грамматика | Язык | Автомат | Ограничения на правила продукции |
|---------------|-------|-----------|-----------------------------------------|
| Тип-0 | Рекурсивно исчислимые | Машина Тьюринга | Без ограничений |
| Тип-1 | Контекстно-зависимые | Линейно-ограниченная недетерминированная машина Тьюринга | `aBc -> adc` (`B` - нетерминал, `a`, `c`, `d` - последовательности терминалов и нетерминалов) |
| Тип-2 | Контестно-свободные | Магазинный автомат |  `A -> b` (`A` - нетерминал, `b` - последовательность терминалов и нетерминалов) |
| Тип-3 | Регулярные | FSM |`A -> bC | b` (`A`,`C` - нетерминалы, `b` - последовательность терминалов) |

Для записи правил продукции грамматик часто используют нормальную форму Бакуса-Наура (BNF или eBNF):

### Вариант BNF-грамматики для регулярных выражений

```
<RE>            ::= <union> | <simple-RE>
<union>         ::= <RE> "|" <simple-RE>
<simple-RE>     ::= <concatenation> | <basic-RE>
<concatenation> ::= <simple-RE> <basic-RE>
<basic-RE>      ::= <star> | <plus> | <elementary-RE>
<star>          ::= <elementary-RE> "*"
<plus>          ::= <elementary-RE> "+"
<elementary-RE> ::= <group> | <any> | <eos> | <char> | <set>
<group>         ::= "(" <RE> ")"
<any>           ::= "."
<eos>           ::= "$"
<char>          ::= any non metacharacter | "\" metacharacter
<set>           ::= <positive-set> | <negative-set>
<positive-set>  ::= "[" <set-items> "]"
<negative-set>  ::= "[^" <set-items> "]"
<set-items>     ::= <set-item> | <set-item> <set-items>
<set-items>     ::= <range> | <char>
<range>         ::= <char> "-" <char>
```

## Парсинг

Парсинг — это процесс разбора текста в соответствии с правилами грамматики, результатом которого, как правило, является синтаксического дерево разбора. Есть множество алгоритмов парсинга. Для контекстно-свободных языков стоит отметить алгоритмы shift-reduce и CYK.

[Парсинг shift-reduce](http://sites.tufts.edu/comp181/2013/10/06/shift-reduce-parsing-bottom-up-parsing/)

[Парсинг CYK](https://www.cs.bgu.ac.il/~michaluz/seminar/CKY1.pdf)

Альтернативой для них является парсинг с помощью грамматики парсинговых выражений (PEG) или же комбинаторов парсеров.

Генераторы парсеров — это инструменты, которые на основе правил продукции грамматики создают программу-парсер. К ним относятся lex/yacc (flex/bison) и ANTLR.


## To read

- http://blogs.perl.org/users/jeffrey_kegler/2014/11/parsing-top-down-versus-bottom-up.html
- http://blogs.perl.org/users/jeffrey_kegler/2014/09/parsing-a-timeline.html
- https://www.cs.york.ac.uk/fp/lsa/lectures/shiftreduce.pdf
- http://bford.info/packrat/
- http://theorangeduck.com/page/you-could-have-invented-parser-combinators
- http://loup-vaillant.fr/tutorials/earley-parsing
- http://www.cs.binghamton.edu/~zdu/parsdemo/srintro.html
- https://explosion.ai/blog/parsing-english-in-python
